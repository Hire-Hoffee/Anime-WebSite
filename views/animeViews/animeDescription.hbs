
<section>
  <div class="container">
    <div class="row mb-3">
      <div class="col-12">
        <div class="content_block_1">
          <h3 class="text-start anime_title anime_title_h4">{{anime.0.title}}</h3>
          <hr style="color: var(--color_3);  opacity:0.8;"> 
        </div>
      </div>
    </div>
    <div class="row mb-5">
      <div class="col-lg-3 col-md-4 col-sm-12 mb-5">
        <div class="content_block_1 anime_descr">
          <img class="img-fluid rounded poster_style" src="{{anime.0.anime_poster}}" alt="anime poster">
          <div class="mt-3">
            <div class="row g-2 mt-1">
              <div class="col-md-auto col-2">
                <i class="bi bi-star-fill">
                  <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="var(--color_3)"
                    class="bi bi-star-fill" viewBox="0 0 16 16">
                    <path
                      d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z" />
                  </svg>
                </i>
              </div>
              <div class="col-md-auto col-4">
                <span style="font-size: 1.5rem; color:var(--color_2)">{{anime.0.rating}}</span>
                <small style="font-size: 0.8rem; color:var(--color_2)">({{anime.0.views}})</small>
              </div>
              {{#if userEntered}}
                <div class="col-md-auto col-6 ms-auto mb-3">
                  {{#if checkRating}}
    <button type="button" class="btn grade_btn pe-4 ps-4 in_favorites">Оценка({{checkRating.0.rating}})</button>
                  {{else}}
                      <button class="btn grade_btn" type="button" data-bs-toggle="collapse" data-bs-target="#rate_btn_collapse" aria-expanded="false" aria-controls="rate_btn_collapse">Оценить</button>
                      <div class="collapse" id="rate_btn_collapse" style="position: absolute;">
                        <div class="card card-body">
                          <form method="post" action="/anime/description/rateAnime/{{anime.0.anime_id}}">
                            <select class="form-select" name="rating">
                              <option selected disabled>Оценка</option>
                              <option value="1">1</option>
                              <option value="2">2</option>
                              <option value="3">3</option>
                              <option value="4">4</option>
                              <option value="5">5</option>
                              <option value="6">6</option>
                              <option value="7">7</option>
                              <option value="8">8</option>
                              <option value="9">9</option>
                              <option value="10">10</option>
                            </select>
                            <button type="submit" class="btn grade_btn mt-3">Оценить</button>
                          </form>
                        </div>
                      </div>
                  {{/if}}
                </div>

                <div class="col-md-12 d-flex justify-content-center">
                  <div class="row">
                    <div class="col-md-12 d-flex justify-content-center">
                      {{#if checkFavorite}}
                        <a href="/users/{{checkFavorite.0.user_id}}/favorites" class="h5_favorite"><h6 class="in_favorites">В избранном</h6></a>
                      {{else}}
                        <form method="post" class="mb-3">
                          <button type="submit" class="btn grade_btn pe-4 ps-4">Добавить в избранное</button>
                        </form>
                      {{/if}}
                    </div>
    
                    <div class="col-md-12 d-flex justify-content-center">
                      {{#if checkViewed}}
                          <a href="/users/{{checkFavorite.0.user_id}}/favorites" class="h5_favorite"><h6 class="in_favorites">Просмотрено</h6></a>
                        {{else}}
                          {{#if checkFavorite}}
                            <form method="post" action="/anime/description/viewedFavorite/{{anime.0.anime_id}}">
                              <button type="submit" class="btn grade_btn pe-4 ps-4">В просмотренное</button>
                            </form>
                          {{/if}}
                      {{/if}}
                    </div>

                  </div>
                </div>
                {{else}}
                  <p>Войдите, чтобы оценить или добавить в избранное</p>
              {{/if}}
            </div>
          </div>
        </div>
      </div>
      <div class="col-lg-8 col-md-8 col-sm-12 ms-md-auto mb-5">
        <div class="content_block_1 anime_descr">
          <h4 class="text-start anime_title_h4">Описание</h4>
          <hr style="color: var(--color_3);  opacity:0.8">
          <ul class="list-group list-group-flush ul-descr">
            <li class="list-group-item"><strong>Тип:</strong> {{anime.0.anime_type}} </li>
            <li class="list-group-item"><strong>Эпизоды:</strong> {{anime.0.episodes}} </li>
            <li class="list-group-item"><strong>Статус:</strong> {{anime.0.anime_status}} </li>
            <li class="list-group-item"><strong>Сезон:</strong> {{anime.0.season_of_the_year}} </li>
            <li class="list-group-item"><strong>Выпуск:</strong> с {{anime.0.date_start}} по {{anime.0.date_end}} </li>
            <li class="list-group-item"><strong>Жанр:</strong> {{#each genre}}{{this.anime_genre}}, {{/each}}</li>
            <li class="list-group-item"><strong>Студия:</strong> {{anime.0.studio}}</li>
            <li class="list-group-item"><strong>Возрастные ограничения:</strong> {{anime.0.age_permission}} </li>
            <li class="list-group-item"><strong>Озвучка:</strong> {{#each voice}}{{this.sound_name}}, {{/each}}</li>
            <li class="list-group-item"><strong>Длительность:</strong> {{anime.0.duration}} </li>
            <li class="list-group-item"><strong>Режиссёр:</strong> {{#each director}}{{this.director_name}}, {{/each}}</li>
            <li class="list-group-item"><strong>Главные герои:</strong> {{#each mainchar}}{{this.char_name}}, {{/each}}</li>
            <li class="list-group-item" style="color: var(--color_2);"><strong>Описание:</strong> {{anime.0.anime_description}} </li>
          </ul>
        </div>
      </div>
    </div>
    <div class="row mb-5">

      <div class="col-12">
        <div class="content_block_1">
          <h4 class="text-start anime_title_h4">Кадры</h4>
          <hr style="color: var(--color_3);  opacity:0.8">
          <div type="button" class="" data-bs-toggle="modal" data-bs-target="#exampleModal">
            <div id="carouselExampleControls1" class="carousel slide" data-bs-ride="carousel">
              <div class="carousel-inner item_size_carosel">
                <div class="carousel-item active">
                  <div class="row">
                    <div class="col"><img src="{{animeIMG.0.img_link}}" class="d-block w-100" alt="anime image"></div>
                    <div class="col"><img src="{{animeIMG.1.img_link}}" class="d-block w-100" alt="anime image"></div>
                    <div class="col"><img src="{{animeIMG.2.img_link}}" class="d-block w-100" alt="anime image"></div>
                    <div class="col hidden_img"><img src="{{animeIMG.3.img_link}}" class="d-block w-100" alt="anime image"></div>
                  </div>
                </div>
                <div class="carousel-item">
                  <div class="row">
                    <div class="col"><img src="{{animeIMG.4.img_link}}" class="d-block w-100" alt="anime image"></div>
                    <div class="col"><img src="{{animeIMG.5.img_link}}" class="d-block w-100" alt="anime image"></div>
                    <div class="col"><img src="{{animeIMG.6.img_link}}" class="d-block w-100" alt="anime image"></div>
                    <div class="col hidden_img"><img src="{{animeIMG.7.img_link}}" class="d-block w-100" alt="anime image"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="modal fade modal_mgn" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel"
            aria-hidden="true">
            <div class="modal-dialog modal-fullscreen modal-dialog-centered mx-auto d-block">
              <div class="modal-content modal_content">
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                <div class="modal-body modalbody">
                  <div class="container corusel_descr_images">
                    <div id="carouselExampleControls" class="carousel slide" data-bs-ride="carousel">
                      <div class="carousel-inner">
                        <div class="carousel-item active item_size">
                          <iframe width="1296" height="603" src="{{anime.0.anime_trailer}}" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                        </div>
                        {{#each animeIMG}}
                        <div class="carousel-item item_size">
                          <img src="{{this.img_link}}" class="d-block w-100 item_size" alt="anime image">
                        </div>
                        {{/each}}
                      </div>
                      <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleControls"
                        data-bs-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Предыдущий</span>
                      </button>
                      <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleControls"
                        data-bs-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Следующий</span>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>


<!-- Modal -->
<div class="modal fade" id="click_off" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-body">
        <p>Просмотр отключен во избежание проблем с авторскими правами.</p>
        <p>Viewing is disabled to avoid copyright issues.</p>
      </div>
      <div class="modal-footer">
        <button type="button" style="background-color: var(--color_2);" class="btn grade_btn" data-bs-dismiss="modal">Закрыть/Close</button>
      </div>
    </div>
  </div>
</div>


<section class="player_section mb-5">
  <div class="container-fluid fullscreenplayer outer_block">
    <div class="container inner_block pb-2 pt-2">
      <div class="row">
        <div class="col-12">
          <h4 class="mb-4">Смотреть аниме "{{anime.0.title}}"</h4>
        </div>
      </div>
      <div class="row">

        <!-- Button trigger modal -->
        <span type="button" data-bs-toggle="modal" data-bs-target="#click_off">
          <div class="col-12 click_off">
            <div>
              <iframe src='{{animeVideo.0.video_link}}' class="iframe_player" frameborder='0' allowfullscreen></iframe>
            </div>
          </div>
        </span>

      </div>
    </div>
  </div>
</section>


<section>
  <div class="container">
    <div class="row">
      <div class="col-12 mb-5">
        <div class="content_block_1">
          <form method="post" action="/anime/{{anime.0.anime_id}}/createComment">
            <div class="mb-3">
              <label for="exampleInputEmail1" class="form-label">
                <h5 class="comments_h5">Оставить комментарий</h5>
                <hr style="color: var(--color_3);  opacity:0.8">
              </label>
              <textarea class="form-control mt-2" id="exampleInputEmail1" aria-describedby="" style="min-height: 100px;" name="user_comment"></textarea>
            </div>
            {{#if userEntered}}
              <button type="submit" class="btn search_nav_btn">Написать</button>
            {{else}}
              <p>Войдите, чтобы отставлять комментарии</p>
            {{/if}}
          </form> 
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-12">
        <div class="content_block_1">
          <h5 class="comments_h5">Комментарии</h5>
          <hr style="color: var(--color_3);  opacity:0.8">
          <div class="mt-4">
            {{#if comments}}
              {{#each comments}}
                <div class="row mb-4 div-comment">
                  <div class="col-1 img-div">
                    <img src="/images/usersAvatars/{{this.user_avatar}}" alt="user_avatar" class="img-fluid comm-img">
                  </div>
                  <div class="col-11">
                    <div class="row">
                      <div class="col-auto">
                        <p class="user-name-comm">
                          {{this.user_name}}
                        </p>
                      </div>
                      <div class="col-auto">
                        <p class="user-name-comm-date">{{this.date_added}}</p>
                      </div>
                      <div class="col-12">
                        <p>
                          {{this.user_comment}}
                        </p>
                      </div>
                    </div>
                  </div>
                </div>
              {{/each}}
            {{else}}
              <h3>Нет комментариев :(</h3>
            {{/if}}
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
